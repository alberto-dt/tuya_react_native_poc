apply plugin: "com.android.application"
apply plugin: "com.facebook.react"

react {
}

def enableProguardInReleaseBuilds = false
def jscFlavor = 'org.webkit:android-jsc:+'

android {
    ndkVersion rootProject.ext.ndkVersion
    compileSdkVersion rootProject.ext.compileSdkVersion

    namespace "com.smartlifeapppoc"
    defaultConfig {
        applicationId "com.smartlifeapppoc"
        minSdkVersion 23
        targetSdkVersion rootProject.ext.targetSdkVersion
        versionCode 1
        versionName "1.0"

        multiDexEnabled true
        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a"
        }

        manifestPlaceholders = [
                TUYA_SMART_APPKEY: "phrvfs7yuqg3rg8sw3km",
                TUYA_SMART_SECRET: "74akfvfua53teq4wvepcd847panjpkee",
                CLEARTEXT_PERMITTED: "true"
        ]
    }

    buildFeatures {
        buildConfig true
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    packagingOptions {
        pickFirst 'lib/*/libc++_shared.so'
        pickFirst '**/libjsc.so'
        pickFirst '**/libreactnativejni.so'
        pickFirst 'META-INF/DEPENDENCIES'
        pickFirst 'META-INF/LICENSE'
        pickFirst 'META-INF/LICENSE.txt'
        pickFirst 'META-INF/NOTICE'
        pickFirst 'META-INF/NOTICE.txt'
        pickFirst 'META-INF/services/javax.annotation.processing.Processor'
    }

    aaptOptions {
        ignoreAssetsPattern "!.svn:!.git:.*:!CVS:!thumbs.db:!picasa.ini:!*.scc:*~"
        additionalParameters "--warn-manifest-validation"
    }

    lintOptions {
        disable 'MissingTranslation'
        disable 'ExtraTranslation'
        disable 'InvalidPackage'
        disable 'StringFormatMatches'
        disable 'StringFormatInvalid'
        checkReleaseBuilds false
        abortOnError false
    }

    androidResources {
        ignoreAssetsPattern "!.svn:!.git:.*:!CVS:!thumbs.db:!picasa.ini:!*.scc:*~"
    }

    signingConfigs {
        debug {
            storeFile file('debug.keystore')
            storePassword 'android'
            keyAlias 'androiddebugkey'
            keyPassword 'android'
        }
    }

    buildTypes {
        debug {
            signingConfig signingConfigs.debug
        }
        release {
            signingConfig signingConfigs.debug
            minifyEnabled enableProguardInReleaseBuilds
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
        }
    }

    repositories {
        flatDir {
            dirs 'libs'
        }

        maven {
            url 'https://maven-other.tuya.com/repository/maven-releases/'
            name 'TuyaMavenReleases'
        }
        maven {
            url 'https://maven-other.tuya.com/repository/maven-commercial-releases/'
            name 'TuyaMavenCommercial'
        }

        google()
        mavenCentral()

        maven { url 'https://jitpack.io' }

        jcenter {
            content {
                includeModule("jp.wasabeef", "recyclerview-animators")
                includeModule("com.geyifeng.immersionbar", "immersionbar")
            }
        }
    }
}

configurations.all {
    exclude group: "com.thingclips.smart", module: 'thingsmart-modularCampAnno'
    exclude group: "com.thingclips.smart", module: 'react-native'
    exclude group: "commons-io", module: "commons-io"

    resolutionStrategy {
        force 'com.google.android.flexbox:flexbox:3.0.0'
        force 'jp.wasabeef:recyclerview-animators:4.0.2'
        force 'com.squareup.okhttp3:okhttp:4.12.0'
        force 'com.squareup.okhttp3:okhttp-urlconnection:4.12.0'
        force 'com.squareup.okio:okio:3.2.0'
        force 'commons-io:commons-io:2.11.0'
        force 'org.jetbrains.kotlin:kotlin-stdlib:1.8.10'
        force 'org.apache.commons:commons-lang3:3.12.0'

        force 'com.facebook.fbjni:fbjni:0.3.0'

        force 'androidx.core:core:1.8.0'
        force 'androidx.fragment:fragment:1.5.0'
        force 'androidx.appcompat:appcompat:1.5.0'
        force 'com.google.android.material:material:1.6.1'

        force 'com.google.android.exoplayer:exoplayer-core:2.18.7'
        force 'com.google.android.exoplayer:exoplayer-ui:2.18.7'

        force 'com.geyifeng.immersionbar:immersionbar:3.2.2'

        dependencySubstitution {
            substitute module('com.google.android:flexbox') using module('com.google.android.flexbox:flexbox:3.0.0')
        }
    }
}

dependencies {
    implementation("com.facebook.react:react-android")

    implementation enforcedPlatform("com.thingclips.smart:thingsmart-BizBundlesBom:6.2.16")

    implementation 'com.google.android.flexbox:flexbox:3.0.0'
    implementation 'jp.wasabeef:recyclerview-animators:4.0.2'

    implementation 'com.squareup.okhttp3:okhttp:4.12.0'
    implementation 'com.squareup.okhttp3:okhttp-urlconnection:4.12.0'
    implementation 'com.squareup.okio:okio:3.2.0'

    implementation 'commons-io:commons-io:2.11.0'
    implementation 'org.jetbrains.kotlin:kotlin-stdlib:1.8.10'
    implementation 'com.facebook.fbjni:fbjni:0.3.0'

    implementation 'androidx.core:core:1.8.0'
    implementation 'androidx.fragment:fragment:1.5.0'
    implementation 'androidx.appcompat:appcompat:1.5.0'
    implementation 'com.google.android.material:material:1.6.1'

    implementation 'com.google.android.exoplayer:exoplayer-core:2.18.7'
    implementation 'com.google.android.exoplayer:exoplayer-ui:2.18.7'

    implementation 'com.geyifeng.immersionbar:immersionbar:3.2.2'

    debugImplementation 'com.facebook.fresco:fresco:2.6.0'
    debugImplementation 'com.facebook.fresco:drawee:2.6.0'
    debugImplementation 'com.facebook.fresco:imagepipeline:2.6.0'

    implementation('com.thingclips.smart:thingsmart:6.2.2') {
        exclude group: 'com.thingclips.smart', module: 'react-native'
        exclude group: 'commons-io', module: 'commons-io'
        exclude group: 'com.squareup.okhttp3'
        exclude group: 'com.squareup.okio'
        exclude group: 'com.facebook.fbjni', module: 'fbjni'
    }

    implementation('com.thingclips.smart:thingsmart-bizbundle-basekit') {
        exclude group: 'com.thingclips.smart', module: 'react-native'
        exclude group: 'com.facebook.fbjni', module: 'fbjni'
        exclude group: 'commons-io', module: 'commons-io'
        exclude group: 'com.squareup.okhttp3'
        exclude group: 'com.squareup.okio'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib'
    }

    implementation('com.thingclips.smart:thingsmart-bizbundle-bizkit') {
        exclude group: 'com.thingclips.smart', module: 'react-native'
        exclude group: 'com.facebook.fbjni', module: 'fbjni'
        exclude group: 'commons-io', module: 'commons-io'
        exclude group: 'com.squareup.okhttp3'
        exclude group: 'com.squareup.okio'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib'
    }

    implementation('com.thingclips.smart:thingsmart-bizbundle-devicekit') {
        exclude group: 'com.thingclips.smart', module: 'react-native'
        exclude group: 'com.facebook.fbjni', module: 'fbjni'
        exclude group: 'commons-io', module: 'commons-io'
        exclude group: 'com.squareup.okhttp3'
        exclude group: 'com.squareup.okio'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib'
    }

    implementation('com.thingclips.smart:thingsmart-bizbundle-device_activator') {
        exclude group: 'com.thingclips.smart', module: 'react-native'
        exclude group: 'com.facebook.fbjni', module: 'fbjni'
        exclude group: 'commons-io', module: 'commons-io'
        exclude group: 'com.squareup.okhttp3'
        exclude group: 'com.squareup.okio'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib'
    }

    implementation('com.thingclips.smart:thingsmart-bizbundle-qrcode_mlkit') {
        exclude group: 'com.thingclips.smart', module: 'react-native'
        exclude group: 'com.facebook.fbjni', module: 'fbjni'
        exclude group: 'commons-io', module: 'commons-io'
        exclude group: 'com.squareup.okhttp3'
        exclude group: 'com.squareup.okio'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib'
    }

    implementation('com.thingclips.smart:thingsmart-bizbundle-panel') {
        exclude group: 'com.thingclips.smart', module: 'react-native'
        exclude group: 'com.facebook.fbjni', module: 'fbjni'
        exclude group: 'commons-io', module: 'commons-io'
        exclude group: 'com.squareup.okhttp3'
        exclude group: 'com.squareup.okio'
        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib'
        exclude group: 'com.tencent.tauth', module: 'qqopensdk'
        exclude group: 'com.huawei.hms', module: 'base'
        exclude group: 'com.gyf.immersionbar', module: 'immersionbar'
    }

    implementation fileTree(dir: 'libs', include: ['*.aar'])
    implementation 'com.alibaba:fastjson:1.1.67.android'

    debugImplementation("com.facebook.flipper:flipper:${FLIPPER_VERSION}")
    debugImplementation("com.facebook.flipper:flipper-network-plugin:${FLIPPER_VERSION}") {
        exclude group:'com.squareup.okhttp3', module:'okhttp'
    }
    debugImplementation("com.facebook.flipper:flipper-fresco-plugin:${FLIPPER_VERSION}")

    if (hermesEnabled.toBoolean()) {
        implementation("com.facebook.react:hermes-android")
    } else {
        implementation jscFlavor
    }
}

apply from: file("../../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"); applyNativeModulesAppBuildGradle(project)
